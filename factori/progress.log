# GPNet Build Progress Log
# Claude Code must append summaries here.
# DO NOT rewrite or delete existing lines.

## 2025-12-07 — initialize_harness ✅
- Installed all npm dependencies (582 packages)
- Started PostgreSQL service, created gpnet3 database and gpnet user
- Created .env file with DATABASE_URL and JWT_SECRET
- Fixed schema.ts line 457: changed `.nullable()` chain to `.$type<T | null>()`
- Fixed storage.ts: removed duplicate `getCaseRecoveryTimeline` method (lines 773-781)
- Installed missing @radix-ui/react-label dependency
- Ran `npm run db:push` — migrations applied successfully
- Ran `npm run seed` — demo data loaded (8 cases)
- Server starts on port 5000 with Vite middleware serving frontend
- API verified: GET /api/gpnet2/cases returns all demo cases
- Pre-existing test failures noted in TimelineCard.test.tsx (6 tests fail due to text matching)

## 2025-12-07 — medical_flags_and_red_risk ✅
- Added 5 new flag types to schema.ts: CERTIFICATE_EXPIRING_SOON, OVERDUE_FOLLOW_UP, WORKER_DISENGAGED, LONG_TAIL_CASE, PSYCHOLOGICAL_INJURY_MARKER
- Enhanced clinicalEvidence.ts with detection logic:
  - Certificate expiring within 7 days
  - CLC follow-up overdue (warning at >0 days, high_risk at >14 days)
  - Worker disengaged (no activity for 30+ days, high_risk at 60+ days)
  - Long-tail case (180+ days off work)
  - Psychological injury keywords detection (PTSD, anxiety, depression, etc.)
- Updated clinicalActions.ts with recommended actions for each new flag type
- Enhanced CaseDetailPanel.tsx to display all severity levels (high_risk, warning, info) with color-coded styling
- API endpoint `/api/cases/:id/clinical-evidence` verified working with new flags

## 2025-12-08 — return_to_work_planner ✅
- Added RTWPlan, RTWPlanPhase, RTWRecommendation interfaces to schema.ts
- Created server/services/rtwPlanner.ts with:
  - Phase templates (graduated_slow, graduated_standard, graduated_fast, direct_return)
  - generateRTWPlan() - creates phased RTW plans based on case data
  - assessPlanSafety() - checks plan against medical restrictions
  - generateRecommendations() - suggests adjustments based on risk level, compliance, etc.
  - deriveRestrictions() - extracts restrictions from medicalConstraints
  - suggestDuties() - recommends appropriate duties based on restrictions
- Added API endpoints:
  - GET /api/cases/:id/rtw-plan - generates an RTW plan for a case
  - POST /api/cases/:id/rtw-plan/assess - assesses safety of a phase
- API verified: returns phased plans with duties, restrictions, review dates, and recommendations

## 2025-12-08 — risk_dashboard ✅
- Added GET /api/dashboard/risk-summary endpoint to server/routes.ts
- Aggregates case data into executive overview:
  - Total cases count and work status breakdown (off work vs at work)
  - Risk breakdown (high/medium/low counts)
  - Flag counts for all active risk flags
  - Urgent cases list (high risk + off work + multiple flags)
  - Company-level risk breakdown
- Created client/src/components/RiskDashboard.tsx UI component:
  - Top-level metrics cards with color-coded risk levels
  - Active risk flags panel with badge counts
  - Urgent cases panel with worker details and flags
  - Company risk breakdown grid
  - Auto-refresh every 60 seconds
- API verified: returns complete risk summary with 8 cases, flag counts, and company breakdown

## 2025-12-08 — timeline_and_recovery_estimator ✅
- Created server/services/recoveryEstimator.ts with:
  - Injury categorization (musculoskeletal minor/moderate/severe, psychological, surgical, chronic, mixed)
  - Benchmark recovery days based on injury category
  - Risk factor identification (high risk, non-compliance, RTW failing, surgery, extended duration, disengagement)
  - Positive factor identification (at work, low risk, compliant, RTW progressing, improving)
  - Progress indicator calculation (on_track, delayed, significantly_delayed)
  - Recovery range estimation (optimistic, realistic, pessimistic)
  - Case-specific recommendations generation
- Added API endpoint:
  - GET /api/cases/:id/recovery-estimate - returns full recovery estimate with summary
- API verified: returns injury category, estimated recovery days/date, risk factors, and recommendations

## 2025-12-08 — claimant_profile_summary ✅
- Created server/services/workerProfile.ts with:
  - generateWorkerProfile() - builds comprehensive profile from case data
  - formatProfileSections() - structures profile into UI-ready sections
  - getStatusLine() - generates one-line status summary
- Profile includes:
  - Basic info (name, company, injury date, case owner)
  - Status snapshot (work status, risk level, compliance, RTW plan, employment)
  - Medical summary (capacity, certificate, restrictions, functional limits, diagnosis)
  - Recovery progress (estimated date, progress indicator, injury category, confidence)
  - Active flags grouped by severity (high risk, warnings, info)
  - Engagement metrics (last activity, follow-ups, ticket count)
  - Recommendations from recovery estimator
- Created client/src/components/WorkerProfileCard.tsx UI component:
  - Compact mode for list views
  - Full profile view with sections grid
  - Color-coded severity indicators
  - AI summary display
- Added API endpoint:
  - GET /api/cases/:id/profile - returns profile, sections, and status line
- API verified: returns comprehensive profile with all sections and recommendations

## 2025-12-10 — weekly_checkin_engine ✅
- Created server/services/weeklyCheckin.ts with:
  - CHECKIN_QUESTIONS - 15 questions across pain, mood, ADL, work, and general categories
  - calculateScores() - converts responses to pain/mood/ADL/work/overall scores
  - detectRiskSignals() - identifies risk signals from responses and score changes
  - generateCheckInSummary() - creates narrative summary from scores and signals
  - calculateTrends() - analyzes trends across multiple check-ins
  - generateTrendSummary() - creates comprehensive trend report with engagement rate
- Risk signal detection for:
  - High/increasing pain levels
  - Low/declining mood
  - Low ADL capability
  - Concerning keywords in text responses (hopeless, suicidal, etc.)
  - Non-compliance with treatment/appointments
- Added API endpoints:
  - GET /api/checkin/questions - returns questionnaire structure
  - POST /api/cases/:id/checkin - creates a new check-in for a case
  - POST /api/checkin/:id/submit - submits responses and calculates scores/signals
  - GET /api/cases/:id/checkins - returns check-in history with trends
  - GET /api/checkin/:id - returns a specific check-in
- API verified: creates check-ins, calculates scores, detects risk signals, generates summaries
