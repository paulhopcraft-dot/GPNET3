---
phase: 03-medical-integration
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - client/src/components/rtw/CurrentRestrictionsPanel.tsx
  - client/src/lib/restrictionUtils.ts
autonomous: true

must_haves:
  truths:
    - "Current restrictions display on RTW planning screen"
    - "Restrictions show visual indicators (green/yellow/red)"
    - "Weight and time limits display with units"
  artifacts:
    - path: "client/src/components/rtw/CurrentRestrictionsPanel.tsx"
      provides: "Visual display of current medical restrictions"
      min_lines: 80
    - path: "client/src/lib/restrictionUtils.ts"
      provides: "Formatting helpers for restriction display"
      exports: ["getCapabilityIcon", "getCapabilityColor", "formatRestrictionValue"]
  key_links:
    - from: "client/src/components/rtw/CurrentRestrictionsPanel.tsx"
      to: "/api/cases/:id/current-restrictions"
      via: "useQuery fetch"
      pattern: "current-restrictions"
---

<objective>
Create the UI component that displays current medical restrictions on the RTW planning screen.

Purpose: MED-09 requires displaying current restrictions on the planning screen. This component visualizes the FunctionalRestrictions data with color-coded capability indicators and formatted limits.

Output: CurrentRestrictionsPanel.tsx component, restrictionUtils.ts helper functions
</objective>

<execution_context>
@D:\dev\gpnet3\.claude/get-shit-done/workflows/execute-plan.md
@D:\dev\gpnet3\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-medical-integration/03-RESEARCH.md
@.planning/phases/03-medical-integration/03-01-SUMMARY.md
@shared/schema.ts (FunctionalRestrictions, RestrictionCapability types)
@client/src/components/ui (shadcn/ui components)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create restrictionUtils.ts helper functions</name>
  <files>client/src/lib/restrictionUtils.ts</files>
  <action>
Create `client/src/lib/restrictionUtils.ts` with display helper functions:

1. Import RestrictionCapability type from shared schema

2. Implement `getCapabilityIcon` function:
```typescript
export function getCapabilityIcon(capability: RestrictionCapability): string {
  switch (capability) {
    case "can": return "check"; // or use Lucide icon name
    case "with_modifications": return "alert-triangle";
    case "cannot": return "x";
    case "not_assessed": return "minus";
    default: return "help-circle";
  }
}
```

3. Implement `getCapabilityColor` function (Tailwind classes):
```typescript
export function getCapabilityColor(capability: RestrictionCapability): string {
  switch (capability) {
    case "can": return "text-green-600";
    case "with_modifications": return "text-yellow-600";
    case "cannot": return "text-red-600";
    case "not_assessed": return "text-gray-400";
    default: return "text-gray-400";
  }
}
```

4. Implement `getCapabilityBgColor` for badges:
```typescript
export function getCapabilityBgColor(capability: RestrictionCapability): string {
  switch (capability) {
    case "can": return "bg-green-100 text-green-800";
    case "with_modifications": return "bg-yellow-100 text-yellow-800";
    case "cannot": return "bg-red-100 text-red-800";
    case "not_assessed": return "bg-gray-100 text-gray-500";
    default: return "bg-gray-100 text-gray-500";
  }
}
```

5. Implement `formatRestrictionLabel` for human-readable names:
```typescript
export function formatRestrictionLabel(key: string): string {
  const labels: Record<string, string> = {
    sitting: "Sitting",
    standingWalking: "Standing/Walking",
    bending: "Bending",
    squatting: "Squatting",
    kneelingClimbing: "Kneeling/Climbing",
    twisting: "Twisting",
    reachingOverhead: "Reaching Overhead",
    reachingForward: "Reaching Forward",
    neckMovement: "Neck Movement",
    lifting: "Lifting",
    carrying: "Carrying",
    pushing: "Pushing",
    pulling: "Pulling",
    repetitiveMovements: "Repetitive Movements",
    useOfInjuredLimb: "Use of Injured Limb",
  };
  return labels[key] || key;
}
```

6. Implement `formatCapabilityLabel` for status display:
```typescript
export function formatCapabilityLabel(capability: RestrictionCapability): string {
  switch (capability) {
    case "can": return "Can Perform";
    case "with_modifications": return "With Modifications";
    case "cannot": return "Cannot Perform";
    case "not_assessed": return "Not Assessed";
    default: return "Unknown";
  }
}
```
  </action>
  <verify>
Run `npm run build` - TypeScript compiles without errors.
  </verify>
  <done>
restrictionUtils.ts exports helper functions for formatting restriction data for display.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CurrentRestrictionsPanel component</name>
  <files>client/src/components/rtw/CurrentRestrictionsPanel.tsx</files>
  <action>
Create `client/src/components/rtw/CurrentRestrictionsPanel.tsx`:

1. Create the directory if needed: `client/src/components/rtw/`

2. Import dependencies:
```typescript
import { useQuery } from "@tanstack/react-query";
import { Check, X, AlertTriangle, Minus, HelpCircle } from "lucide-react";
import type { FunctionalRestrictions, RestrictionCapability } from "@shared/schema";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Skeleton } from "@/components/ui/skeleton";
import {
  getCapabilityColor,
  getCapabilityBgColor,
  formatRestrictionLabel,
  formatCapabilityLabel,
} from "@/lib/restrictionUtils";
```

3. Define props interface:
```typescript
interface CurrentRestrictionsPanelProps {
  caseId: string;
}
```

4. Define API response type:
```typescript
interface RestrictionsResponse {
  restrictions: FunctionalRestrictions;
  maxWorkHoursPerDay: number | null;
  maxWorkDaysPerWeek: number | null;
  source: "single_certificate" | "combined";
  certificateCount: number;
  retrievedAt: string;
}
```

5. Implement component with:
- TanStack Query to fetch /api/cases/:id/current-restrictions
- Loading state with skeletons
- Error state with helpful message
- Empty state when no restrictions found

6. Display structure:
- Header with title and source badge (e.g., "Combined from 2 certificates")
- Time Limits section (if maxWorkHoursPerDay or maxWorkDaysPerWeek exist)
- Physical Demands section grouped by category:
  - Mobility: sitting, standingWalking, bending, squatting, kneelingClimbing, twisting
  - Reaching: reachingOverhead, reachingForward, neckMovement
  - Manual Handling: lifting (with liftingMaxKg), carrying (with carryingMaxKg), pushing, pulling
  - Other: repetitiveMovements, useOfInjuredLimb
- Each item shows icon + label + capability badge

7. Use color-coded icons:
```typescript
function CapabilityIcon({ capability }: { capability: RestrictionCapability }) {
  const className = `h-4 w-4 ${getCapabilityColor(capability)}`;
  switch (capability) {
    case "can": return <Check className={className} />;
    case "with_modifications": return <AlertTriangle className={className} />;
    case "cannot": return <X className={className} />;
    case "not_assessed": return <Minus className={className} />;
    default: return <HelpCircle className={className} />;
  }
}
```

8. Display weight limits inline:
```typescript
{item.key === "lifting" && restrictions.liftingMaxKg && (
  <span className="text-sm text-gray-500 ml-2">
    (max {restrictions.liftingMaxKg} kg)
  </span>
)}
```

9. Export as default and named export:
```typescript
export function CurrentRestrictionsPanel({ caseId }: CurrentRestrictionsPanelProps) { ... }
export default CurrentRestrictionsPanel;
```
  </action>
  <verify>
Run `npm run build` - TypeScript compiles without errors.
Component renders without errors when imported.
  </verify>
  <done>
CurrentRestrictionsPanel.tsx displays current restrictions with visual indicators and formatted limits.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes
2. client/src/lib/restrictionUtils.ts exports all helper functions
3. client/src/components/rtw/CurrentRestrictionsPanel.tsx renders without errors
4. Component displays loading, error, and data states appropriately
5. Color coding: green (can), yellow (with_modifications), red (cannot), gray (not_assessed)
</verification>

<success_criteria>
- Restrictions display with visual capability indicators
- Weight limits show with kg units
- Time limits show hours/days per week
- Source indicator shows when data is combined from multiple certificates
- Loading and error states are user-friendly
- Component integrates with TanStack Query for data fetching
</success_criteria>

<output>
After completion, create `.planning/phases/03-medical-integration/03-03-SUMMARY.md`
</output>
