---
phase: 07-email-generation
plan: 03
type: execute
wave: 3
depends_on: ["07-01", "07-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "EMAIL-01 to EMAIL-08: AI-generated email with all required sections (Phase 6 - verified)"
    - "EMAIL-09: Organization templates with variable substitution work"
    - "EMAIL-10: Send Email sends via SMTP and logs audit trail"
    - "Copy to clipboard still works"
    - "Email locked after plan approval"
  artifacts: []
  key_links: []
---

<objective>
Verify all EMAIL-01 to EMAIL-10 requirements are implemented and working

Purpose: Confirm Phase 7 Email Generation is complete before proceeding to Phase 8
Output: Verification confirmation and phase completion
</objective>

<execution_context>
@C:\Users\Paul\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Paul\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

# Prior plan summaries
@.planning/phases/07-email-generation/07-01-SUMMARY.md
@.planning/phases/07-email-generation/07-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    EMAIL-01 to EMAIL-10: Complete RTW plan manager email generation and sending capability:
    - AI-powered email generation with plan context (Phase 6)
    - Organization-specific email templates with Handlebars (Plan 01)
    - Send Email button with confirmation dialog (Plan 02)
    - SMTP sending with audit logging (Plan 02)
  </what-built>
  <how-to-verify>
1. **Navigate to an existing RTW plan:**
   - Go to a case with an RTW plan
   - Click to view the plan details
   - Scroll to Manager Notification Email section

2. **Verify email content (EMAIL-01 to EMAIL-08):**
   - Email has subject line with worker name and plan type
   - Body includes manager greeting
   - Body includes worker name, role, injury date (EMAIL-02)
   - Body includes medical constraints summary (EMAIL-03)
   - Body includes proposed duties (suitable/modified/excluded) (EMAIL-04)
   - Body includes hours schedule by week (EMAIL-05)
   - Body includes review date if applicable (EMAIL-06)
   - Body has approval request (EMAIL-07)
   - Professional formatting with sections (EMAIL-08)

3. **Verify Copy to Clipboard (EMAIL-10 partial):**
   - Click "Copy to Clipboard" button
   - Paste in a text editor
   - Confirm subject and body are copied

4. **Verify Send Email (EMAIL-10):**
   - Click "Send Email" button
   - Dialog appears with privacy warning
   - Enter a test email address
   - Click "Send Email" in dialog
   - Observe:
     - If SMTP configured: email sends, success toast appears
     - If no SMTP: logged to console (dev mode), success toast appears
   - Check database: audit_events table has entry with action="email_sent"

5. **Verify email locking (OUT-08):**
   - If plan status is "approved", verify email fields are disabled
   - Regenerate button should be hidden for approved plans

6. **Verify template fallback (EMAIL-09):**
   - Without org template: AI generates email (or fallback template if no API key)
   - With org template in database: template renders with variables
   - (Template CRUD UI is out of scope for Phase 7 - will be added later)
  </how-to-verify>
  <resume-signal>Type "approved" if all EMAIL requirements verified, or describe issues</resume-signal>
</task>

</tasks>

<verification>
All EMAIL-01 to EMAIL-10 requirements verified:
- [ ] EMAIL-01: Auto-generate email with manager greeting
- [ ] EMAIL-02: Include worker name, role, injury date
- [ ] EMAIL-03: Include medical constraints summary
- [ ] EMAIL-04: Include proposed duties (suitable, modified, excluded)
- [ ] EMAIL-05: Include proposed hours schedule
- [ ] EMAIL-06: Include review date
- [ ] EMAIL-07: Include approval request call-to-action
- [ ] EMAIL-08: Professional formatting with sections
- [ ] EMAIL-09: Organization templates with variable substitution
- [ ] EMAIL-10: Send email directly OR copy to clipboard
</verification>

<success_criteria>
- All 10 EMAIL requirements verified as working
- No regressions in Phase 6 functionality
- Email sending works (SMTP or dev logging)
- Audit trail captures email sends
- User approves the verification checkpoint
</success_criteria>

<output>
After user approval, create `.planning/phases/07-email-generation/07-03-SUMMARY.md` with verification results.

Then update:
1. `.planning/STATE.md` - Mark Phase 7 complete
2. `.planning/REQUIREMENTS.md` - Check off EMAIL-01 to EMAIL-10
3. `.planning/ROADMAP.md` - Mark Phase 7 plans complete
</output>
