---
phase: 04-functional-ability-matrix
plan: 04
type: execute
wave: 3
depends_on: ["04-02", "04-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Matrix displays as true table grid with duties as rows and demand categories as columns"
    - "Each cell is color-coded: green (suitable), yellow (with modification), red (not suitable)"
    - "Tooltips show demand/frequency/capability details on hover"
    - "Overall suitability column shows aggregate duty status"
    - "Table is responsive with horizontal scroll on narrow screens"
    - "Warnings displayed when data confidence is low"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Functional Ability Matrix visualization works correctly end-to-end.

Purpose: Final human verification that the matrix displays correctly, colors are accurate, tooltips work, and the overall user experience meets FAM-08 requirements.

Output: Verified working matrix visualization, ready for integration into RTW planning flow (Phase 5)

**SCOPE NOTE:**
Phase 4 delivers suitability PREVIEW on duty templates.
Override functionality is deferred to Phase 8 when RTW plan instances exist.
</objective>

<execution_context>
@C:\Users\Paul\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Paul\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-functional-ability-matrix/04-01-SUMMARY.md
@.planning/phases/04-functional-ability-matrix/04-02-SUMMARY.md
@.planning/phases/04-functional-ability-matrix/04-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Functional Ability Matrix with:
    - TRUE matrix layout: duties as rows, demand categories (15 columns) as headers
    - Color-coded cells: green (suitable), yellow (with modification), red (not suitable)
    - Tooltips showing demand/frequency/capability details on hover
    - Overall suitability column at the end of each row
    - Responsive horizontal scroll for narrow screens
    - Sticky first column (duty name) while scrolling
    - Warning banner when data confidence is low
  </what-built>
  <how-to-verify>
    1. Start the development server: `npm run dev`

    2. Ensure test data exists:
       - A worker case with current medical restrictions (Phase 3)
       - A role with multiple duties having demand ratings (Phase 2)

    3. Navigate to where the FunctionalAbilityMatrix component is rendered
       (may need to temporarily add to a test page if not yet integrated)

    4. Verify matrix structure:
       - [ ] Table has column headers: Duty | Sit | Stand | Walk | Bend | Squat | Kneel | Twist | OH | Fwd | Lift | Carry | Rep | Conc | Stress | Pace | Overall
       - [ ] Each duty appears as a row
       - [ ] Cells are colored appropriately based on suitability

    5. Verify color coding:
       - [ ] Green cells for "suitable" matches
       - [ ] Yellow cells for "suitable_with_modification" matches
       - [ ] Red cells for "not_suitable" matches
       - [ ] Colors are consistent and readable

    6. Verify tooltips:
       - [ ] Hover over any colored cell
       - [ ] Tooltip shows demand name, frequency, capability, and result
       - [ ] Tooltip disappears when mouse moves away

    7. Verify responsive behavior:
       - [ ] Narrow the browser window
       - [ ] Table scrolls horizontally
       - [ ] Duty name column stays visible (sticky)

    8. Verify warnings (if applicable):
       - [ ] If worker has incomplete restrictions, warning banner shows
       - [ ] Warning message is helpful and actionable

    9. Verify overall column:
       - [ ] Shows aggregate suitability for each duty
       - [ ] Colored appropriately
       - [ ] Text is readable

    10. API verification:
        - Open browser DevTools > Network tab
        - Reload the page
        - [ ] GET /api/functional-ability/matrix request succeeds
        - [ ] Response contains duties array with dutyId (not planDutyId)
        - [ ] Response includes demandDetails for each duty
  </how-to-verify>
  <resume-signal>Type "approved" if matrix displays correctly per FAM-08 requirements, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Matrix renders as true table (not cards)
2. All 15 demand category columns display
3. Color coding is correct and consistent
4. Tooltips provide useful information
5. Responsive design works on narrow screens
6. API returns correct data structure
</verification>

<success_criteria>
- Visual inspection confirms FAM-08 matrix requirements met
- User can quickly scan suitability across all duties and demands
- No console errors or broken UI elements
- Ready for integration into RTW planning workflow (Phase 5)
</success_criteria>

<output>
After completion, create `.planning/phases/04-functional-ability-matrix/04-04-SUMMARY.md`
</output>
