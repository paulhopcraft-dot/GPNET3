---
phase: 11-system-wide-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/e2e/fixtures/auth.fixture.ts
  - tests/e2e/fixtures/test-data.ts
  - playwright.config.ts
  - vitest.config.ts
autonomous: true

must_haves:
  truths:
    - "Auth fixture provides reusable login across all E2E tests"
    - "Test data constants are centralized and consistent"
    - "Playwright config supports wave-based test tagging (@smoke, @critical, @regression, @performance)"
  artifacts:
    - path: "tests/e2e/fixtures/auth.fixture.ts"
      provides: "Reusable authenticatedPage fixture for Playwright"
      exports: ["test", "expect"]
    - path: "tests/e2e/fixtures/test-data.ts"
      provides: "Test credentials and constants"
      exports: ["EMPLOYER_CREDENTIALS", "ADMIN_CREDENTIALS", "TEST_CASE_IDS"]
    - path: "playwright.config.ts"
      provides: "Playwright config with grep filtering for tags"
      contains: "grepInvert"
  key_links:
    - from: "tests/e2e/fixtures/auth.fixture.ts"
      to: "tests/e2e/fixtures/test-data.ts"
      via: "import for credentials"
      pattern: "import.*test-data"
---

<objective>
Set up test infrastructure for Phase 11 system-wide testing.

Purpose: Establish reusable fixtures, test data, and configuration so that subsequent test plans can focus on test logic rather than setup boilerplate.

Output: Auth fixture, test data constants, updated Playwright config with tag support.
</objective>

<execution_context>
@C:\Users\Paul\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Paul\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-system-wide-testing/11-RESEARCH.md

# Existing test patterns
@tests/e2e/gpnet-dashboard.spec.ts
@tests/e2e/auth-sessions.spec.ts
@playwright.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth fixture for reusable login</name>
  <files>
    tests/e2e/fixtures/auth.fixture.ts
    tests/e2e/fixtures/test-data.ts
  </files>
  <action>
Create tests/e2e/fixtures/ directory with two files:

1. test-data.ts - Export test constants:
   - EMPLOYER_CREDENTIALS: { email: 'employer@test.com', password: 'password123' }
   - ADMIN_CREDENTIALS: { email: 'admin@gpnet.local', password: 'ChangeMe123!' }
   - TEST_CASE_IDS: Array of known valid case IDs from seed data (e.g., ['s25wf307549'])
   - BASE_URL: Read from process.env.PLAYWRIGHT_BASE_URL or default to 'http://localhost:5000'
   - PERFORMANCE_TARGETS: { dashboard: 5000, caseList: 5000, caseDetail: 5000 } (ms)

2. auth.fixture.ts - Export extended Playwright test with authenticatedPage fixture:
   - Import base test and expect from @playwright/test
   - Import credentials from test-data.ts
   - Create test.extend() with authenticatedPage fixture that:
     - Navigates to /login
     - Fills email and password inputs
     - Clicks submit button
     - Waits for URL to match /employer|/cases|/ pattern (timeout 15s)
     - Yields the logged-in page to the test
   - Export { test, expect } for use in spec files

Follow pattern from existing auth helpers in auth-sessions.spec.ts and treatment-tab-comprehensive.spec.ts but as reusable fixture.
  </action>
  <verify>
    - File tests/e2e/fixtures/auth.fixture.ts exists and exports test, expect
    - File tests/e2e/fixtures/test-data.ts exists and exports credentials
    - TypeScript compiles: npm run build (no errors in test fixtures)
  </verify>
  <done>Auth fixture importable by other spec files with `import { test, expect } from '../fixtures/auth.fixture'`</done>
</task>

<task type="auto">
  <name>Task 2: Update Playwright config for wave-based tagging</name>
  <files>playwright.config.ts</files>
  <action>
Update playwright.config.ts to support test tagging:

1. Add grep/grepInvert support for running tests by tag:
   - Add to defineConfig: grep: process.env.TEST_GREP ? new RegExp(process.env.TEST_GREP) : undefined
   - This allows: TEST_GREP="@smoke" npx playwright test

2. Add reporter configuration for CI-friendly output:
   - reporter: [['list'], ['html', { open: 'never' }]]
   - This gives console output plus HTML report

3. Ensure existing config preserved:
   - Keep testDir: 'tests/e2e'
   - Keep timeout: 60000
   - Keep baseURL and webServer config

4. Add globalSetup if needed for test data seeding (optional, create empty file reference).

Do NOT change retries (keep at 0 for accurate failure detection during development).
  </action>
  <verify>
    - npm run test:e2e -- --list shows all tests
    - TEST_GREP="@smoke" npm run test:e2e -- --list filters correctly (may show 0 until smoke tests created)
  </verify>
  <done>Playwright config supports tag-based test filtering via TEST_GREP environment variable</done>
</task>

<task type="auto">
  <name>Task 3: Add npm scripts for wave-based test execution</name>
  <files>package.json</files>
  <action>
Add convenience scripts to package.json for running tests by wave:

Add to scripts section:
- "test:e2e:smoke": "cross-env TEST_GREP=@smoke playwright test"
- "test:e2e:critical": "cross-env TEST_GREP=@critical playwright test"
- "test:e2e:regression": "cross-env TEST_GREP=@regression playwright test"
- "test:e2e:performance": "cross-env TEST_GREP=@performance playwright test"
- "test:e2e:all": "playwright test"
- "test:e2e:report": "playwright show-report"

This allows easy wave-based execution:
- npm run test:e2e:smoke (fast feedback, ~2 min)
- npm run test:e2e:critical (core flows, ~10 min)
- npm run test:e2e:all (everything)
  </action>
  <verify>
    - npm run test:e2e:smoke runs (may show "no tests matched" until smoke tests created)
    - npm run test:e2e:all runs existing tests
  </verify>
  <done>npm scripts exist for wave-based test execution</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run build` passes (TypeScript compiles)
2. `npm run test:e2e -- --list` shows test list
3. Auth fixture importable (checked by TypeScript)
4. Test data constants exported correctly
</verification>

<success_criteria>
- tests/e2e/fixtures/ directory contains auth.fixture.ts and test-data.ts
- playwright.config.ts supports TEST_GREP filtering
- package.json has wave-based npm scripts
- All files TypeScript-valid (npm run build passes)
</success_criteria>

<output>
After completion, create `.planning/phases/11-system-wide-testing/11-01-SUMMARY.md`
</output>
