---
phase: 02-admin-roles-duties
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - client/src/pages/admin/roles/RolesList.tsx
  - client/src/pages/admin/roles/RoleForm.tsx
  - client/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Admin can see list of all roles with duty counts"
    - "Admin can search roles by name"
    - "Admin can navigate to create new role"
    - "Admin can edit existing role"
    - "Admin can delete role (with confirmation)"
    - "Form validates required fields"
  artifacts:
    - path: "client/src/pages/admin/roles/RolesList.tsx"
      provides: "Role list page with search and actions"
      min_lines: 100
    - path: "client/src/pages/admin/roles/RoleForm.tsx"
      provides: "Create/Edit role form"
      min_lines: 150
  key_links:
    - from: "client/src/pages/admin/roles/RolesList.tsx"
      to: "/api/admin/roles"
      via: "TanStack Query useQuery"
      pattern: "queryKey.*admin/roles"
    - from: "client/src/pages/admin/roles/RoleForm.tsx"
      to: "/api/admin/roles"
      via: "TanStack Query useMutation"
      pattern: "mutationFn.*fetch.*admin/roles"
---

<objective>
Create frontend pages for managing RTW job roles (ADMIN-01 to ADMIN-04 UI).

Purpose: Provide the admin interface for employers to view and manage their job roles.
Output: React list page and form page following existing CompanyList/CompanyForm patterns.
</objective>

<execution_context>
@C:\Users\Paul\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Paul\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-admin-roles-duties/02-RESEARCH.md
@client/src/pages/admin/CompanyList.tsx (list page pattern)
@client/src/pages/admin/CompanyForm.tsx (form page pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RolesList page</name>
  <files>client/src/pages/admin/roles/RolesList.tsx</files>
  <action>
Create a role list page following the CompanyList.tsx pattern exactly:

1. Page header with title "Job Roles" and "Add Role" button (links to /admin/roles/new)

2. Search input for filtering roles by name

3. Table with columns:
   - Name (text)
   - Description (text, truncated)
   - Duties count (number from dutyCount field)
   - Status (Active/Inactive badge)
   - Actions (Edit, Manage Duties, Delete buttons)

4. Use TanStack Query:
   - queryKey: ["/api/admin/roles", { search }]
   - Show loading spinner while fetching
   - Show empty state if no roles

5. Edit button: navigate to /admin/roles/:id
6. Manage Duties button: navigate to /admin/roles/:id/duties
7. Delete button:
   - Show AlertDialog confirmation
   - Use useMutation with DELETE request
   - On success: invalidate roles query, show toast
   - On error (409 active plans): show error toast with message

Use icons: Plus, Pencil, ListTodo, Trash2 from lucide-react
Use components: Card, CardHeader, CardContent, CardTitle, Button, Input, Table, Badge, AlertDialog
  </action>
  <verify>
Run: npm run build
Expected: No TypeScript errors in RolesList.tsx
  </verify>
  <done>
RolesList page compiles, displays roles with search and CRUD actions
  </done>
</task>

<task type="auto">
  <name>Task 2: Create RoleForm page</name>
  <files>client/src/pages/admin/roles/RoleForm.tsx</files>
  <action>
Create a role form page following the CompanyForm.tsx pattern exactly:

1. Back button linking to /admin/roles

2. Form fields:
   - Name (required, Input)
   - Description (optional, Textarea)
   - Active Status (Switch, default true)

3. Use react-hook-form with Zod validation:
   const roleSchema = z.object({
     name: z.string().min(1, "Role name is required"),
     description: z.string().optional(),
     isActive: z.boolean().default(true),
   });

4. Edit mode detection via useParams() for id
   - If editing: fetch role data with useQuery
   - Use form.reset() in useEffect when data loads

5. Submit mutations:
   - Create: POST /api/admin/roles
   - Update: PUT /api/admin/roles/:id
   - On success: invalidate queries, navigate to list, show toast
   - On error: show error toast

6. Loading state while fetching (edit mode)
7. Submit button shows loading spinner during save

Use components: Card, CardHeader, CardContent, CardTitle, CardDescription, Button, Input, Textarea, Label, Switch
  </action>
  <verify>
Run: npm run build
Expected: No TypeScript errors in RoleForm.tsx
  </verify>
  <done>
RoleForm page compiles, handles both create and edit modes
  </done>
</task>

<task type="auto">
  <name>Task 3: Register routes in App.tsx</name>
  <files>client/src/App.tsx</files>
  <action>
Add routes for the roles pages in the admin section of App.tsx:

1. Import the components:
   import RolesList from "@/pages/admin/roles/RolesList";
   import RoleForm from "@/pages/admin/roles/RoleForm";

2. Add routes inside the admin layout section (near other /admin/* routes):
   <Route path="/admin/roles" element={<RolesList />} />
   <Route path="/admin/roles/new" element={<RoleForm />} />
   <Route path="/admin/roles/:id" element={<RoleForm />} />

3. Ensure these routes are protected with RequireAuth wrapper if pattern exists in file
  </action>
  <verify>
Run: npm run dev
Navigate to: http://localhost:5173/admin/roles
Expected: Roles list page renders without errors
  </verify>
  <done>
Routes registered, roles pages accessible in browser
  </done>
</task>

</tasks>

<verification>
- [ ] npm run build passes
- [ ] /admin/roles shows list of roles
- [ ] Search filters roles by name
- [ ] /admin/roles/new shows create form
- [ ] /admin/roles/:id shows edit form with loaded data
- [ ] Create role saves and redirects
- [ ] Edit role saves and redirects
- [ ] Delete shows confirmation and removes from list
</verification>

<success_criteria>
Admin can view role list, create new roles, edit existing roles, and delete roles (with active plan protection) via the UI.
</success_criteria>

<output>
After completion, create `.planning/phases/02-admin-roles-duties/02-03-SUMMARY.md`
</output>
